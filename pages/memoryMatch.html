<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Memory Match</title>
        <style>
            .tile {
                font-size: xx-large;
                width: 50px;
                height: 50px;
                line-height: 50px;
                background-color: gray;
                text-align: center;
            }

            td {
                width: 55px;
                height: 55px;
            }

        </style>
    </head>
    <body>
        <header>
        <nav>
        <section id="MemoryNav">
        <a href="/pages/index.html" id="homeNav">Sage Page</a>
        </nav>
        </header>

        <h1>Welcome to Memory Match</h1>
        <p><button onclick='gameReset()'>Reset Game</button></p>
        <div id='gameBoard'></div>

        <script>
            let grid= [];
            let map = [];
            let tile1 = null, tile2 = null;

            let loadMap= (rows=4, cols=4) => { // use arrow notation for function
                const grid= []; // one dimensional array to store number pairs
                let maxValue= (rows * cols / 2);
                console.log(maxValue); // Output: (4 * 4) / 2 = 8
                for (let maxValue = 0; maxValue < 8; maxValue++) {
                    let num1= maxValue * 1 + 1;
                    let num2= maxValue * 1 + 1;
                    grid.push(num1, num2); // adds the numbered pair to the  grid array
                }
                return grid
                console.log(grid); // Output: [1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8]
                console.log('Grid output: ' + '[' + grid + ']' );
            }

            // FISHER-YATES shuffle algorithm, to shuffle the array
            const shuffle = (grid) => {
                for (let i = grid.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                let temp = grid[i];
                grid[i] = grid[j];
                grid[j] = temp;
                }
                return grid; // Assigned to grid var in gameReset()
            }

            let makeBoard= (rows=4, cols=4) => {
               let output = '<table>';
                for (let row = 0; row < rows; row ++) {
                    output += '<tr>';
                        for (let col = 0; col < cols; col++) {
                            output += '<td><button' +
                                ' class="tile"' +
                                ' id="' + row + '_' + col + '"' +
                                ' onclick="process (' + row + ',' + col + ')">' +
                                '</button></td>';
                        }
                        output += '</tr>';
                }
                document.getElementById('gameBoard').innerHTML = output + '</table>';
            }

            let gameReset= () => {
                grid= loadMap(4, 4);
                console.log(grid);
                let shuffledArray= shuffle(grid); // function call to randomize the 1D array
                console.log(shuffledArray); // Output: Randomized array of 16 single digit elements (1-8)
                //makeBoard(4, 4);

                // Nested loops to create 2D Array to global var map=[]
                map=[]
                //const array2D = [];
                let i = 0;
                for (let row = 0; row < 4; row++) {
                    const Arow = [];
                    //array2D[row] = [];
                    for ( let col = 0; col < 4; col++) {
                        Arow.push(shuffledArray[i]);
                        i++;
                    }
                    map.push(Arow);
                }
                makeBoard(4, 4);
                console.log(map);                
            }

            
            let process= (row=4, col=4) => {
                let clicked_tile = document.getElementById(row + '_' + col);

                // Clicked tile not already contains data
                if (!Boolean(clicked_tile.innerHTML)) {

                    // Tile 1 not yet selected
                    if (!tile1) {
                        tile1= clicked_tile;
                        clicked_tile.innerHTML = map[row][col];
                    }

                    // Tile 2 not yet selected
                    else if (!tile2) {
                        tile2= clicked_tile;
                        clicked_tile.innerHTML = map[row][col];

                        // Optional: Can adjust interval time as desired (milliseconds)
                        setTimeout(checkMatch,1000);
                    }
                }
            }

            const checkMatch= () => {
                // Compares the two clicked tiles using the global variables, 
                // if matched, both tiles removed from board
                // if not matched, inner contents will display blank squares

                if (tile1.innerHTML == tile2.innerHTML) {
                    tile1.hidden = true;
                    tile2.hidden = true;
                }
                tile1.innerHTML = '';
                tile2.innerHTML = '';
                tile1 = tile2 = null;
            }

        </script>
    </body>
</html>