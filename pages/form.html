<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment Form</title>

    <link href="https://fonts.googleapis.com/css2?family=Electrolize&family=Geo:ital@0;1&family=Iceberg&family=Michroma&family=Nabla&family=Orbitron:wght@400..900&family=Quantico:ital,wght@0,400;0,700;1,400;1,700&family=Silkscreen:wght@400;700&family=Zen+Dots&display=swap" rel="stylesheet">

    <style>
        /* CSS styling */
        body, h1, h3 {
            text-align: center;
            background-color: blueviolet;
        }

        h1, h3, .sageText {
            font-family: 'Iceberg';
            margin-bottom: 1em;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;

            /* Form outline */
            padding: 3em;
            border: 5px solid #cccccc;
            width: 50%;
            margin: 1em auto;
            border-radius: 1em;
        }

        .inputBoxes, #inputLabels {
            font: 1em 'Orbitron';
            margin-top: .5em;
        }

        label {
            /* Uniform size & alignment */
            display: inline-block;
            min-width: 45px;
            text-align: right;
        }

        input {
            /* To make sure that all the text fields have the same font settings */
            font: 1em 'Electrolize';
            /* Uniform text field size */
            width: 300px;
            box-sizing: border-box;
            /* Matches form field borders */
            border: 1px solid #999999;
        }

        textarea {
            display: block;
            font: 1em 'Orbitron';
            margin: 1em auto;
            box-sizing: border-box;
            border: 5px double blueviolet;
        }

        .button {
            /* Align button with the text fields */
            margin: 1em auto; /* matches the same size as the label elements */
        }

        button {
            margin: 1em auto 0 auto;
            width: auto;
            align-self: center;
        }

        #accountCreationContainer {
            max-width: 500px;
            margin: 2em auto;
            padding: 1em;
            border: 1px solid #3a2074;
            background: #000000;
            border-radius: 1.5em;
        }

        .accountCreation label,
        .accountCreation input {
            display: block;
            margin-bottom: 0.6em;
            /* To make sure that all the text fields have the same font settings */
            font: 1em 'Electrolize';
            color:  antiquewhite;
            /* Uniform text field size */
            width: max-content;
            box-sizing: border-box;
        }




    </style>
</head>
<body>
    <h1 id="title" style="position: center;">Cipher Sage Comment Form</h1>

    <p class="sageText">Have something to say, enter information and leave a <strong>Comment</strong>
    below!</p>

    <form id="commentForm" action="#" method="POST">
        <p id="inputLabels" class="inputBoxes">

        <label for="name">Name:</label>
        <input
            id="name"
            type="text"
            name="name"
            pattern="[A-Za-z ]{2,30}"
            title="Your name must be between 2 and 50 characters, containing only letters and spaces."
            required
            >
        
        <!--Need to fix styling of the format-->
        <label for="phone">Phone:<br />
        <!--small>Format: 123-456-7890</small-->
        </label>
        <input
            id="phone"
            type="tel"
            name="phoneNum"
            pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
            title="Please match the format: 123-456-7890"
            >

        <label for="email">Email:</label>
        <input id="email" type="email" name="email" autocomplete="email" title="example email: john.doe@email.com">
        </p>

        <h3>Leave a comment:</h3>
        <textarea id="msg" type="text" name="userMsg" rows="5" cols="40" placeholder="Type here..."></textarea>

        <span id="feedbackMsg" style="color: yellow;font-weight: normal;">Fill the data and click the button when finished.</span><br>
            <button type="submit">Send Your Message</button><br>

        <span id="invalidFormMessage" style="color: red;font-weight: normal;"></span>
    </form>

    <!--    Account creation container for user registration info   -->
    <div id="accountCreationContainer">
        <h3>Create Your Account</h3>
        <form id="accountCreation" action="#" method="POST">
            <fieldset id="createAccount" class="accountCreation">
                <label for="userName">Username:</label>
                <input
                    id="userName"
                    type="text"
                    name="userName"
                    minlength="8 characters minimum"
                    maxlength="20 characters maximum"
                    title="Username is not case-sensitive, can contain letters, numbers, and underscores."
                >
                <label for="password">Password:</label>
                <input
                    id="password"
                    type="password"
                    name="password"
                    minlength="8 characters minimum"
                    pattern="/^"
                    title="Password must contain one upper-case, one lowercase, one number, and one special character."
                >
            </fieldset>
        </form>
    </div>

    <script>

        // This is used to perform checks on user input and make sure they dont do any of the below options
        document.getElementById('commentForm').addEventListener('submit', function(event){
            let name= document.getElementById('name').value;
            let phone= document.getElementById('phone').value;
            let email=document.getElementById('email').value;
            let message= document.getElementById('msg').value;
            let invalidFormMessage= document.getElementById('invalidFormMessage');
            const errors= [];

             // Prevents the submission of the form until data meets reuirements
            // if (name === "" || phone === "" || email === "") {
            //     invalidFormMessage.innerText= 'Fields cannot be blank. All fields must be filled out to submit.';
            //     event.preventDefault();
            // }

            //  return for each conditional check sequentially, to show the user what is needed in order to submit form
            if (!name)
                errors.push("Name is required.");
            if (!phone)
                errors.push("Phone is required.");
            if (!email)
                errors.push("Email is required.");
            if (!message)
                errors.push("Don't forget to enter your comment!");
            if (name && email && name === email)
                errors.push("Email and name cannot be the same.")
            if (name && email && name.includes(email))
                errors.push("Name cannot contain your full email address.");

                // nested func to sanitize data after input is received
                function sanitizeHtmlSpecialChars(str) {
                    if (typeof str !== 'string') {
                        return str; //  returns as is, if not a string
                    }
                    //  replaces ampersand char, this is done first because '&' is part of other entities and needs to be handled before them
                    return  str.replace(/&/g, '&amp;')  
                                .replace(/</g, '&lt;')           //  replaces all occurences of the less-than sign
                                .replace(/>/g, '&gt;')          //  replaces all occurences of the greater-than sign
                                .replace(/"/g, '&quot;')         //  replaces all occurrences of the double quote
                                .replace(/'/g, '&#039;')       //  replaces all occurrences of the single quote, using the numeric entity for single quotes
                }
            //  one big check at the end if fields pass validation
            if (errors.length > 0) {
                console.log("Invalid form, does not meet requirements.");
                //  displays each error message on a newline (basic)
                invalidFormMessage.innerText= errors.join("\n");
                
                //  creates an list of bulleted errors for display (better readability? needs a little CSS to clean up white space)
                //invalidFormMessage.innerHTML= "<ul><li>" + errors.join("</li><li>") + "</li></ul>";
                event.preventDefault();
                return;
            }

            // Validated data is sanitized and stored in an array for logging
            let formData= [
                sanitizeHtmlSpecialChars(name),
                sanitizeHtmlSpecialChars(phone), 
                sanitizeHtmlSpecialChars(email),
                sanitizeHtmlSpecialChars(message)
            ];
            console.log("Valid Data Accepted: ", formData)
            invalidFormMessage.style.color= "white";
            invalidFormMessage.style.fontWeight= "bold";
            invalidFormMessage.innerText= "Valid Data Accepted: Your form was submitted!";
            event.preventDefault(); //  prevents actual submission in order to show valid data in console log

            // clears fields after valid submission but keeps the valid message displayed to user
            this.reset();
        });
        
        //  Validation checks to follow below   //
        //  30 char maximum, input of correct name using one lower-case and, one upper-case letter
        //  checks that phone is entered correctly and no special characters in name
        // the EventListener will inform the user in real-time what is required when adding data to forms!!!

        // TODO: use JS to perform validation checks on username and password inputs!!!

        // name validation func
        document.getElementById('name').addEventListener('input', function() {
            console.log('user is typing in name input');
            let name= this.value;
            let feedbackMsg=document.getElementById('feedbackMsg');
            const missing= [];

            if (name.length > 50)
                missing.push('50- character maximum');

            let hasLower= /[a-z]/.test(name);
            if (!hasLower)
                missing.push('lower-case letter');

            let hasUpper= /[A-Z]/.test(name);
            if (!hasUpper)
                missing.push('Upper-case letter');

            let hasNumber= /[0-9]/.test(name);
            if (hasNumber) {
                missing.push('cannot contain numbers');
            }

            let hasSpecial= /[$%&*!@#]/.test(name);
            if (hasSpecial)
                missing.push('no special characters in name');

            feedbackMsg.innerText= "Name requirements: " + missing.join(", ");
            });

        //  phone validation func
        document.getElementById('phone').addEventListener('input', function() {
            console.log('user is typing in phone input');
            let phone= this.value;
            let feedbackMsg=document.getElementById('feedbackMsg');
            const pattern= /^[1-9]\d{2}-\d{3}-\d{4}$/;        //  regex ('regular expression') expression matching format: 123-456-7890
            const missing= [];

            let hasTel= /[0-9]/.test(phone);
            if (!hasTel)
                missing.push('Incorrect phone number');

            if (!pattern.test(phone)) {
                feedbackMsg.innerText= "Phone number must be in this format: 123-456-7890";
            }
            else {
                feedbackMsg.innerText= "";
            }
            });

            //  email validation func
        document.getElementById('email').addEventListener('input', function() {
            console.log('user is typing in email input');
            let email= this.value;
            let feedbackMsg=document.getElementById('feedbackMsg');
            const pattern= /^[^@\s]+@[^@\s]+\.[^@\s]+$/;        //  regex expression matching format: abc@email.xxx
            
            if (!pattern.test(email)) {
                feedbackMsg.innerText= "Please enter a valid email address that includes @ and . (domain)";
            } else {
                feedbackMsg.innerText= "";
            }

            //  comment validation func
        document.getElementById('msg').addEventListener('input', function() {
            console.log('user is typing comment input');
            let comment= this.value;
            let feedbackMsg= document.getElementById('feedbackMsg');

            if (comment === "")
                    feedbackMsg.innerText= "Don't forget to enter your comment then submit.";

            if (comment.length < 1)
                feedbackMsg.innerText= "Type a comment."
            else 
                feedbackMsg.innerText= "";
            });
        });

    </script>

    
</body>
<footer>
    <a href="/index.html" id="sagePage">Return to homepage.</a>
</footer>
</html>